##GPGPUを使った並列計算　

私は昨年まで生命科学科というところにいたのだが、卒研では生物は全く関係無いGPUによるプログラムの高速化をやることに…。現在はバイオインフォマティクスを中心としたデータ解析をメインテーマとして研究中。

---
　 
- はじめに

ビッグデータという言葉が飛び交うようになった昨今、大量のデータを処理するためにコンピュータの計算能力が重要となる。

今回はGPUを使った並列計算の現状とその応用について紹介する。

---
- GPUとは

GPUはGraphical Processor Unitの略称で
コンピュータにおけるグラフィック性能を向上させたり、
機能を補うPCパーツの一つで、ゲーム用コンピュータなどに多く搭載されている。
GPUは元々画像処理を目的として設計されている。これは
数百から数千の演算コアを持ち、この演算コアを**高速かつ並列に動かす
ことで行列計算などを行い**精細かなめらかな描画を可能にしている。

---
- なぜGPUなのか？

GPUは大量の演算コアをフル活用することで
旧型のもので**数百**GFLOPS
最新のもので**約5.6Tera**FLOPSの演算能力を持つ
(※最新型のCPU(Intel Core i7 [Haswell] )であっても224GFLOPS位)

近年この計算能力を汎用演算に応用する取り組み（GPGPUと呼ぶ）が普及しNVIDIA社製品を中心に汎用演算に対応したGPUも多く販売されているため一般のユーザーでも扱いやすくなってきている。

このため安価かつ手軽にスーパーコンピューターのような計算能力を作れる。

- GPGPUについて
GPGPUはGeneral　Purpose　computing　on GPUの略でGPUの持つ高い演算能力を、

 1. 気象予測や津波のシミュレーション

 2. バイオインフォマティクスや医学画像シミュレーション

 3. データ解析やデータベース処理

などを研究目的として汎用演算に利用する試みのことをいう

---
- GPUコンピューティングの仕組み

CPUでの処理ではたくさんのデータを処理するときにfor文などのループを使うが

GPUコンピューティングはCPUが通常ループで繰り返し行う処理をGPUにデータを転送してGPU上のマルチプロセッサで分散してその結果をCPUに返すことでループが必要なくなり、処理時間を大幅に短縮することが出来る。

CPU上で行うループが多い処理ほどGPUで計算させると高速化が期待できる。

---

- 開発環境

現時点でGPGPUの開発環境は主に二つ

1. ATIStream・・・AMD社が提供するOpenCLベースの開発環境で**OpenCLのAPIの知識が必要**で、少しとっつきにくい

2. CUDA・・・C言語とC++言語をベースにしており、他の言語でのライブラリ開発も盛ん。**対応GPUも多い。**
 
本日は2つめのCUDAについて紹介する。

---

- 統合開発環境CUDA

NVIDIA社が提供しているGPGPUの開発環境でドライバー、ライブラリ、コンパイラ、サンプルを一つのパッケージとして提供している

CUDA Cと呼ばれるC/C++を少し拡張した言語でCPUとGPUを制御するプログラムを書く。

サンプルの中には金融工学で用いられるブラック・ショールズのテストプログラムなども含まれているなど応用範囲は多岐にわたっている。

---
- CUDA・GPUコンピューティングの難点

　1.　CUDA Cでコーディングするときは特にGPUとCPUメモリ空間がどうなっているかという**デバイスに関する知識**、が必要となる。

　2.　条件分岐を多用するような**難しいプログラムには向かない**

　3.　それぞれの演算器が独立にかつブロック単位で動くので**データの参照先や出力先が独立でないようなプログラムでは使用しづらい。**

　4.　CPU-GPU間の**データ転送時間がかかる**のでその分タイムロスが生じる。

---
- 上手くGPUを使うために

GPUにとってやさしいプログラムを組む

例えば、CPU上でGPU並列計算がしやすい型式にしてGPUにデータを転送したり、GPUで計算させる時は条件分岐やメモリアクセスが複雑な計算はさせないようにするとか、計算結果の後処理はCPUにデータを返してから行うとか・・・・

あとはC言語以外の言語で書くという方法も

---

- 他の言語での応用

CUDA Cは主にC/C++言語でコーディング、コンパイルするが、バインディングを利用することで、データ解析に多く用いられるRubyやPython、MATLABでも使用することができる。

Ruby：Barracuda

Python：PyCUDA

MATLAB:MATLAB Plugin For CUDA 		etc…

---

- 統計解析言語Rでの利用

今や統計解析では欠かせないツールとなったR言語でもCUDA.GPUを利用した高速計算を行うためのライブラリが公開されている。
gputoolsライブラリ:使える関数が多い、ちょっとだけ遅い
rpudライブラリ：gputoolsよりも少し速い、関数が少ない、SVMのカーネルをいじることができる
使える関数

---

 - 実際に使ってみた①

RのGPUライブラリrpudを使って性能比較を行った

総データ数1000万の行列の計算をR標準のdist関数とrpudライブラリ内のrpuDist関数で速度比較した。

その結果、CPUで計算する標準関数が1分半〜2分かかったのに対して、rpuDist関数は約1.5〜3秒で済んだ。ちなみに、gputoolsのgpuDistは2.3秒位だった。


---
  - 実際に使ってみた②

もう一つ、1024×1024の行列積計算をC言語とCUDA Cによる並列計算で比較した結果が次の通り

Cのみで書いた方は約1分かかったのに対してGPU並列計算を組み合わせたプログラムは約3秒でCPUより約20倍の速度が出た。

※CPU、GPUどちらも古い型のものでテストしているので実際はもっと速くなる。CPUは9秒、GPUは1秒以下とか…

---

 - データ解析・統計分野での応用

大量のデータに同じ処理を一斉に実行するような場面でGPUを使う。

例)残差の計算、行列演算

大量の演算コアを使ってシミュレーションの回数を増やす。

---
- まとめ
CUDAなら簡単にGPU並列コンピューティングが体験できる。

計算量が大きくなるほどCPUとの処理能の差が大きくなる。

処理するデータ量が大きすぎて困ったらCUDA対応GPUを使ってみては？

ご静聴ありがとうございました
